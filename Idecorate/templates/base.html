{% load i18n idecorate_interface %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>{% block title %}{% endblock %}</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="">
        <meta name="author" content="">
        <link runat="server" rel="shortcut icon" href="/media/images/favicon.2.ico" type="image/x-icon" />
        <link runat="server" rel="icon" href="/media/images/favicon.2.ico" type="image/ico" />
        <link rel="stylesheet" type="text/css" href="/media/interface/css/global.css">
        <link rel="stylesheet" type="text/css" href="/media/interface/css/datepicker.css">
        <link rel="stylesheet" type="text/css" href="/media/interface/css/dropdown.css">
        <link rel="stylesheet" type="text/css" href="/media/interface/js/dropdown/css/dropdown.css">

        {%  block style %}{% endblock %}

        <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <style>
        .ui-autocomplete-category {
            font-weight: bold;
            padding: .2em .4em;
            margin: .8em 0 .2em;
            line-height: 1.5;
        }   
        #page-mask {
            position: fixed;
            -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=50)";
            filter: alpha(opacity=50);
            -moz-opacity: 0.5;
            -khtml-opacity: 0.5;
            opacity: 0.5;
            background-color: black;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 99999;
        }
        #modal-login-signup-window {
            border: 5px solid #DDD;
            position: fixed;
            width: 800px;/*
            */
            height: auto;
            overflow: hidden;
            background-color: white;
            box-shadow: 0 0 8px #333;
            z-index: 99999;
            top: 10%;
            background-image: url(/media/images/idecorate_pattern.jpg);
            background-repeat: repeat;
        }
        #modal-login-signup-window h2 {
            margin: 0 5px 0 0;
            padding: 0;
            text-align: right;
        }
        #modal-login-signup-window a#close-login-signup-modal{
            text-decoration: none;
            color: #666;
        }
        #modal-login-signup-window iframe {
        /*height: 480px;*/
        min-height: 375px;
        max-height: 700px;
        width: 100%;
        }
        h2 {
            font-size: 156.25%;
        }
        h1, h2, h3, h4, h5 {
            font-weight: normal;
        }
        </style>
    </head>
    <body>
        <div id='fb-root'></div>
        <script src='http://connect.facebook.net/en_US/all.js'></script>
        <div id="main-container">
            <header id="header">
                {% include "header.html" %}
            </header>

            <div id="content" class="clearfix">
                {% block content %}
                {% endblock %}
            </div>
            
            <footer id="footer" class="clearfix">
                {% include "footer.html" %}                
            </footer>
        </div> <!-- /container -->
        <!-- login. signup modal -->
        <div id="page-mask" style="display:none;"></div>        
        <div id="modal-login-signup-window" style="display:none;">
            <h2 id="modal-login-signup-header">
                <a href="#" id="close-login-signup-modal">&times;</a>
            </h2>
            <div id="iframe-login-signup-wrap"></div>
        </div> 
        <script src="/media/interface/js/jquery-1.8.2.min.js"></script>
        <script src="/media/interface/js/jquery-ui.js"></script>
        <script src="/media/interface/js/jquery.placeholder.js"></script>
        <script type="text/javascript" src="/media/interface/js/dropdown/js/jquery.dropdown.js"></script>
        <script type="text/javascript" src="/media/interface/js/dropdown/js/jquery.hoverflow.js"></script>
        <script type="text/javascript">
            $(function() {
                var dateToday = new Date();
                var dates = $("#datepicker").datepicker({
                    defaultDate: "+1w",
                    changeMonth: true,
                    numberOfMonths: 1,
                    minDate: dateToday,
                    showOn: "button",
                    buttonImage: "http://jqueryui.com/resources/demos/datepicker/images/calendar.gif",
                    buttonImageOnly: true ,
                    changeYear: true,
                    showOtherMonths: true,
                    selectOtherMonths: true,
                    showButtonPanel: true,
                    onSelect: function(selectedDate) {
                        var option = this.id == "from" ? "minDate" : "maxDate",
                            instance = $(this).data("datepicker"),
                            date = $.datepicker.parseDate(instance.settings.dateFormat || $.datepicker._defaults.dateFormat, selectedDate, instance.settings);
                        dates.not(this).datepicker("option", option, date);
                    }
                });

                $('.dd').dropdown({
                    subClass: 'sub-menu'
                }).show();


                /**
                $( "#datepicker" ).datepicker({
                    showOn: "button",
                    buttonImage: "http://jqueryui.com/resources/demos/datepicker/images/calendar.gif",
                    buttonImageOnly: true ,
                    changeMonth: true,
                    changeYear: true,
                    showOtherMonths: true,
                    selectOtherMonths: true,
                    showButtonPanel: true
                });
                **/

                $('#close-login-signup-modal').click(closed_modal);
                generate_user_nav();
                $('input[type="text"]').placeholder();
            });
            function generate_user_nav(){
                var navs = '<li><a href="#" id="logged_as">{{ user|get_nickname }}</a></li>' + 
                '<li style="border-left:1px solid #ffffff"><a id="lnk-logout" href="#">Logout</a></li>' + 
                '<li><a href="#" id="lnk-login-signup">Login/Signup</a></li>';        
                $('#site-menu ul.dropdown2').append(navs);
                $('#lnk-logout').bind('click',logmeout);
                $('#logged_as').bind('click',goto_profile);
                $('#site-menu ul a#lnk-login-signup').bind('click',popup_login);
                {% if user.is_authenticated %}        
                $('#lnk-login-signup').parent().hide();
                {% else %}
                $('#logged_as').parent().hide();
                $('#lnk-logout').parent().hide();
                {% endif %}
            }
            function goto_profile(){
                window.location.href = '{% url profile %}';
            }
            function logged(val){
                $('#logged_as').text(val);
                $('#lnk-login-signup').parent().hide();
                $('#logged_as').parent().show();
                $('#lnk-logout').parent().show();
                closed_modal();
            }
            var currentUrl = '{{ currentUrl }}';
            function logmeout(){
                $.get('{% url logout %}',function(){
                    if ( currentUrl == '/profile' ){
                        window.location.href = '{% url home %}';
                    } else {
                        $('#lnk-login-signup').parent().show();
                        $('#logged_as').parent().hide();
                        $('#lnk-logout').parent().hide();
                    }
                });
                return false;
            }
            function closed_modal(){
                $('#page-mask').hide();
                $('#modal-login-signup-window').hide();
            }
            function popup_login(){
                var iframe  = $('<iframe />').attr({'class':'modalIframe','id':'modal-login-signup-iframe','src':"{% url login_signup %}",'frameborder':'0'});
                var modal   = $('#modal-login-signup-window'),
                    _left   = $(window).width()/2-modal.width()/2;
                    frame   = $('#iframe-login-signup-wrap').html(iframe);

                $('#page-mask').css({display:'block'});
                modal.css({display:'block',left:_left});
            }
            $(function() {
                   var zIndexNumber = 1000;
                   // Put your target element(s) in the selector below!
                   $("ul.dropdown li").each(function() {
                           $(this).css('zIndex', zIndexNumber);
                           zIndexNumber -= 10;
                   });
                   $("ul.dropdown2 li").each(function() {
                           $(this).css('zIndex', zIndexNumber);
                           zIndexNumber -= 10;
                   });
            });
            
        </script>
        <script type="text/javascript">
        var SEARCH_SUGGESTION_URL = '{% url search_suggestions %}';
        </script>
        <script src="/media/interface/js/search.js"></script>
        {% block javascripts %}{% endblock %}
    </body>
</html>
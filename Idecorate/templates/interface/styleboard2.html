{% load i18n idecorate_interface %}
{{ request|set_last_page_idecorate }}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta charset="utf-8">
        <title>iDecorate Weddings</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="">
        <meta name="author" content="">
        <link rel="shortcut icon" href="/media/images/favicon.1.ico" type="image/x-icon" />
        <link rel="icon" href="/media/images/favicon.1.ico" type="image/ico" />
        <link rel="stylesheet" type="text/css" href="/media/interface/css/styleboard2.css">
        <link rel="stylesheet" type="text/css" href="/media/interface/js/ui/css/jquery.ui.core.css">
        <link rel="stylesheet" type="text/css" href="/media/interface/js/dropdown/css/dropdown.css">
        <link rel="stylesheet" type="text/css" href="/media/interface/css/dropdown.css">
        <link rel="stylesheet" type="text/css" href="/media/interface/css/datepicker.css">
        <link rel="stylesheet" type="text/css" href="/media/interface/css/themes/base/jquery.ui.all.css">
        <link rel="stylesheet" type="text/css" href="/media/interface/css/themes/ui-lightness/jquery.ui.all.css">
        <link rel="stylesheet" type="text/css" href="/media/interface/js/ui/css/jquery.ui.resizable.css">
        <link rel="stylesheet" type="text/css" href="/media/interface/js/colorpicker/css/spectrum.css" />
        <link rel="stylesheet" type="text/css" href="/media/interface/js/selectbox/css/jquery.selectbox.css" />
        <!--[if lt IE 9]>
        <style type="text/css">
            #canvas img{
               background: transparent;
              zoom: 1;
            }
        </style>
        <![endif]-->
        <script type="text/javascript">
            var PRODUCT_IMAGE_URL           = '{% url get_product_original_image %}';
            var category_id                 = {{ cat_id }};
            var media_url                   = '{{ MEDIA_URL }}';
            var STYLEBOARD_AJAX_URL         = '{% url styleboard_ajax %}';
            var STYLEBOARD_PRODUCT_AJAX_URL = '{% url styleboard_product_ajax %}';
            var CATEGORY_TREE_AJAX_URL      ='{% url get_category_tree_ajax %}';
            var ADD_TO_CART_URL             = '{% url add_to_cart_ajax %}';
            var REMOVE_TO_CART_URL          = '{% url remove_from_cart_ajax %}';
            var REMOVE_ALL_CART_URL          = '{% url remove_all_cart_ajax %}';
            var UPDATE_CART                 = '{% url update_cart %}';
            var CHECKOUT_URL                = '{% url checkout %}';
            var MODAL_SRC                   = '{% url crop 0 %}';
            var PRODUCT_DETAILS_URL         = '{% url get_product_details %}';
            var SET_PRODUCT_POSITION_URL    = '{% url set_product_positions %}';
            var SEARCH_PRODUCT_URL          = '{% url search_products %}';
            var PRODUCT_POSITIONS           = {% if save_styleboard %}''{% else %}{{ product_positions }}{% endif %};
            var has_change_mode             = false;
            var styleboard_mode_type        = '{{ mode }}';
            var sub_category_count          = {{ category_count }};
            var mode_toggle_tab             = false;
            var save_styleboard_action      = false;
            var logined                     = {% if user.is_authenticated %}true{% else %}false{% endif %};
            var TEXT_IMG_GEN_URL            = '{% url generate_text %}';
            var EMB_IMG_GEN_URL             = '{% url generate_embellishment %}';
            var UPLOAD_EMBELLISMENT_PROG    = '{% url upload_embellishment_progress %}';
            var EMBELLISHMENT_UPLOAD_ACTION = '{% url upload_embellishment_action %}';
            var MAX_UPLOAD_EMBELLISHMENT_IMAGE_SIZE = {{ max_emb_size }};
            var PERSONALIZE_ID              = {% if save_styleboard %}{{ save_styleboard.styleboard_item.id }}{% else %}0{% endif %};
            var PERSONALIZE_ITEM            = '{% if personalize_item %}{{ personalize_item }}{% else %}{% endif %}';
            var GET_PERSONALIZE_CART_URL    = '{% url get_personalize_cart_items %}';
            var is_window_resized           = false;
            var GET_TEMPLATES_LIST_URL      = '{% url get_template_items %}';
            var create_current_tab          = 'products';
            var GET_TEMPLATES_DETAIL_URL    = '{% url get_template_details %}';
        </script>
        <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <style type="text/css">
        #modal-login-signup-window {
            border: 5px solid #DDD;
            position: fixed;
            width: 800px;
            height: auto;
            overflow: hidden;
            background-color: white;
            box-shadow: 0 0 8px #333;
            z-index: 99999;
            top: 10%;
            /*background-image: url('/media/images/idecorate_pattern.jpg');
            background-repeat: repeat;*/
        }
        #modal-save-styleboard-window {
            border: 5px solid #DDD;
            position: fixed;
            width: 500px;/*
            */
            height: auto;
            overflow: hidden;
            background-color: white;
            box-shadow: 0 0 8px #333;
            z-index: 99999;
            top: 10%;
            /*
            background-image: url('/media/images/idecorate_pattern.jpg');
            background-repeat: repeat;*/

        }
        #modal-login-signup-window h2, #modal-save-styleboard-window h2 {
            margin: 0 5px 0 0;
            padding: 0;
            text-align: right;
        }
        #modal-login-signup-window a#close-login-signup-modal, #modal-save-styleboard-window a.close-modal-btn{
            text-decoration: none;
            color: #666;
        }
        #modal-login-signup-window iframe {
        /*height: 480px;*/
        min-height: 375px;
        max-height: 700px;
        width: 100%;
        }
        #modal-save-styleboard-window iframe {
        /*height: 480px;*/
        min-height: 375px;
        max-height: 700px;
        width: 100%;
        }
        #embellishments .breadcrumb-wrap .breadcrumb li{
            *margin-bottom: 2px !important;
        }
        .file-wrapper, .submit-wrapper {
          cursor: pointer;
          display: inline-block;
          overflow: hidden;
          position: relative;
        }
        .file-wrapper input[type=file] {
            height: 30px;
            cursor: pointer;
            position: absolute;
            top: 0px;
            right: 0px;
            font-size: 100px;
            z-index: 2;
            opacity: 0.0; /* Standard: FF gt 1.5, Opera, Safari */
            filter: alpha(opacity=0); /* IE lt 8 */
            -ms-filter: "alpha(opacity=0)"; /* IE 8 */
            -khtml-opacity: 0.0; /* Safari 1.x */
            -moz-opacity: 0.0; /* FF lt 1.5, Netscape */
        }
        .file-wrapper .button, .tp-button {
          cursor: pointer;
          display: inline-block;
          font-size: 12px;
          margin-right: 5px;
          padding: 4px 18px;
        }
        .file-holder {
            font-size: 12px;
        }
        #embellishments .breadcrumb-wrap ul.breadcrumb{
            *margin: 0;
            padding: 0;
        }
        #styleboard tbody.bodyWrap tr td#sidebar-wrap #sidebar #create-tab #embellishments {
            overflow: hidden;
        }
        #styleboard tbody.bodyWrap tr td#sidebar-wrap #sidebar #create-tab #embellishments #embelishments-list-wrap {
            overflow: auto;
        }
        #styleboard tbody.bodyWrap tr td#sidebar-wrap #sidebar #create-tab #embellishments .formWrap {
            height: 60px;
        }
        .invisible {
            display: none !important;
        }
        </style>
    </head>
    <body>
        <div id="compact-header">
            <table border="0" cellpadding="0" cellspacing="0">
                <thead class="headWrap">
                    <tr class="headWraptop">
                        <td id="info-menu">
                            <div class="headerColumn clearfix">
                                {{ "info"|getInterfaceMenus }}
                            </div>
                            <div class="search clearfix">
                                <form action="{% url styleboard %}" method="POST">
                                    <input id="search" name="search" type="text" value="{{ keyword }}" placeholder="Search Products" /> 
                                    <input type="image" src="/media/images/search.png" class="searchIcon" />
                                    <input type="submit" value="Search" class="searchButton" />
                                </form>
                            </div>
                        </td>
                        <td id="logo">
                            <div class="headerColumn clearfix">
                            <a href="{% url home %}">
                                <img src="/media/images/logo_txt.jpg" title="logo" />
                            </a>
                            </div>
                        </td>
                        <td id="site-menu">
                            <div class="headerColumn clearfix">
                                {{ "site"|getInterfaceMenus }}
                            </div>
                        </td>
                    </tr>
                </thead>
            </table>
        </div>
        <table id="styleboard" cellpadding="0" cellspacing="5">
            <tbody class="bodyWrap">
                <tr valign="top" height="100%">
                    <td id="sidebar-wrap">
                        <ul id="sidebar-nav" class="etabs sideNav clearfix">
                            <li class="tab"><a href="#create-tab" id="createTab">Create</a></li>
                            <li class="tab"><a href="#buy-tab" id="buyTab">Buy</a></li>
                        </ul>
                        <div id="sidebar">
                            <div id="sidebar-form-wrap"  class="clearfix">
                                <h3>My order <div class="myorder-edit"><a href="#buy-tab" class="hidden">edit</a></div></h3>
                                {% csrf_token %}
                                <fieldset>
                                    <div class="sidebarInputs">
                                        <label for="guests">
                                            <input type="text" id="guests" name="guests" placeholder="Guests" value="{{ global_default_quantity }}" /> Guests
                                        </label>
                                        <label for="tables">
                                            <input type="text" id="tables" name="tables" placeholder="Tables" value="{{ global_guest_table }}" /> Tables
                                        </label>
                                    </div>
                                    <div class="sidebarTotals">
                                        <h5>Total: <span id="my-order-total">$0.00</span></h5>
                                    </div>
                                </fieldset>
                            </div>
                            <div id="create-tab">
                                <div id="create-tab-nav">
                                    <ul class="sideNav">
                                        <li><a href="#products">Products</a> | </li>
                                        <li><a href="#embellishments">Embellishments</a> | </li>
                                        <li><a href="#templates">Templates</a></li>
                                    </ul>
                                </div>
                                <div id="products" style="display:none;">
                                    <div class="breadcrumb-wrap">
                                        {% if mode != 'search' %}
                                        {{ cat_id|get_breadcrumb }}
                                        {% else %}
                                        <ul class="breadcrumb">
                                            <li><a href="#">All</a></li>
                                            <li> <span>></span> </li><li class="active"><span>Search Results</span></li>
                                        </ul>
                                        {% endif %}
                                    </div>
                                    <div class="product-list-wrap">
                                        {% include 'interface/styleboard_categories.html' %}
                                    </div>
                                    <div class="pagination"></div>
                                </div>
                                <div id="embellishments" style="display:none;">
                                    <div class="formWrap">
                                        <form id="upload-embel" method="POST">                                            
                                            <input type="hidden" id="X-Progress-ID" name="X-Progress-ID" value=""/>
                                            <input type="hidden" id="id" name="id" value=""/>
                                            <fieldset>
                                                <legend>Upload Image</legend>
                                                <span class="file-wrapper">
                                                    <input type="file" name="picture" id="picture" placeholder="from computer" />
                                                    <input id="btn-from-my-computer" class="button" type="button" value="From my computer" />
                                                </span>
                                                <span class="submit-wrapper">
                                                    <input id="form_submit_button" style="display:none" class="tp-button" type="submit" value="Upload" />
                                                </span>
                                            </fieldset>
                                        </form>
                                    </div>
                                    <div class="breadcrumb-wrap"></div>
                                    <div id="embelishments-list-wrap" class="clearfix">
                                        <div class="emCat">
                                            <a href="{% url get_embellishment_items %}" rel="1" class="image em">
                                                {{ 1|getEmbellishmentThumbnail }}
                                                <span>Images</span>
                                            </a>
                                            <a href="{% url get_embellishment_items %}" rel="text" class="text em">
                                                {{ "TEXT"|getTextThumbnail }}
                                                <span>Text</span>
                                            </a>
                                            <a href="{% url get_embellishment_items %}" rel="5" class="border em">
                                                {{ 5|getEmbellishmentThumbnail }}
                                                <span>Borders</span>
                                            </a>
                                            <a href="{% url get_embellishment_items %}" rel="4" class="shape em">
                                                {{ 4|getEmbellishmentThumbnail }}
                                                <span>Shapes</span>
                                            </a>
                                            <a href="{% url get_embellishment_items %}" rel="2" class="texture em">
                                                {{ 2|getEmbellishmentThumbnail }}
                                                <span>Textures</span>
                                            </a>
                                            <a href="{% url get_embellishment_items %}" rel="3" class="pattern em">
                                                {{ 3|getEmbellishmentThumbnail }}
                                                <span>Patterns</span>
                                            </a>
                                        </div>
                                        <div class="emItem">
                                            <!-- <a id="emb-1" _type="Image" class="thumb draggable em"><img src="/generate_embellishment/?embellishment_id=1&amp;embellishment_color=000000000&amp;embellishment_thumbnail=1&amp;embellishment_size=100"></a><a id="emb-2" _type="Image" class="thumb draggable em"><img src="/generate_embellishment/?embellishment_id=2&amp;embellishment_color=000000000&amp;embellishment_thumbnail=1&amp;embellishment_size=100"></a><a id="emb-3" _type="Image" class="thumb draggable em"><img src="/generate_embellishment/?embellishment_id=3&amp;embellishment_color=000000000&amp;embellishment_thumbnail=1&amp;embellishment_size=100"></a><a id="emb-4" _type="Image" class="thumb draggable em"><img src="/generate_embellishment/?embellishment_id=4&amp;embellishment_color=000000000&amp;embellishment_thumbnail=1&amp;embellishment_size=100"></a><a id="emb-5" _type="Image" class="thumb draggable em"><img src="/generate_embellishment/?embellishment_id=5&amp;embellishment_color=000000000&amp;embellishment_thumbnail=1&amp;embellishment_size=100"></a> -->
                                        </div>
                                    </div>
                                    <div class="pagination"></div>
                                </div>
                                <div id="templates" style="display:none;">
                                    <div class="template-wrap"></div>
                                    <div class="pagination"></div>
                                </div>                       
                            </div>
                            <!-- end of create -->
                            <div id="buy-tab" style="display:none">
                                <div class="buyTableWrap">
                                    <div class="table">
                                        <div class="thead">
                                            <table width="100%">
                                                <tr>
                                                    <th>Item</th>
                                                    <th>Quantity</th>
                                                    <th>Price</th>
                                                </tr>
                                            </table>
                                        </div>
                                        <div class="tbody">
                                            <table id="buy-table">                                            
                                                <tbody></tbody>
                                            </table>
                                        </div>
                                        <div class="tfoot">
                                            <table width="100%">
                                                <tr>
                                                    <th>Total: <span id="cart-total-cur"></span><span id="cart-total-amount"></span></th>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>                                
                                </div>
                                <div class="checkOutWrap">                            
                                    <input id="check-button" type="button" value="CHECKOUT" class="globalBtn checkoutButton"/>
                                </div>
                            </div>
                            <!-- end of buy -->
                        </div>
                    </td>
                    <td id="canvas-wrap">
                        <div id="canvas">
                            <div class="handles">
                                <div class="fakeHandle"></div>
                            </div>
                            <div class="nwMenus" style="display:none;">
                                <ul class="canvasControl">
                                    <li><a href="#" id="save">Save</a></li>
                                    <li><a href="{% url new_styleboard %}" id="new">New</a></li>
                                    <li class="do"><a href="#" id="undo">Undo</a><a href="#" id="redo">Redo</a></li>
                                </ul>
                            </div>
                            <div class="neMenus">
                                <div class="imgControlWrap clearfix">
                                    <ul class="imgControl clearfix">
                                        <li><a href="#" id="remove-btn">Remove</a></li>
                                        <li><a href="#" id="flip-btn">Flip</a></li>
                                        <li><a href="#" id="flap-btn">Flop</a></li>
                                        <li><a href="#" id="clone-btn">Clone</a></li>
                                        <li><a href="#" id="forward-btn">Forward</a></li>
                                        <li><a href="#" id="backward-btn">Backward</a></li>
                                    </ul>
                                </div>
                                <div class="imgBgControlWrap">
                                    <ul class="imgBgControl">
                                        <li>
                                            <a href="#" id="whiteBg-btn"></a>
                                        </li>
                                        <li>
                                            <a href="#" id="transBg-btn"><div></div></a>
                                        </li>
                                        <li>
                                            <a href="#" id="customBg-btn"><div></div></a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="colorAdjustment clearfix">
                                    <div id="color-picker-wrap">
                                        <input type='text' id="colorPicker"/>
                                    </div>
                                    <div id="opacity-control-wrap">
                                        <div class="opacity-control-label clearfix">
                                            <span class="subtract">-</span>
                                            <span class="label">Opacity</span>
                                            <span class="add">+</span>
                                        </div>
                                        <div id="slider"></div>
                                    </div>
                                    <div id="text-change-wrap" class="clearfix">
                                        <form>
                                            <select name="font_id" id="font_id">
                                                {% for text_item in text_items %}
                                                <option value="{{ text_item.id }}">/generate_text/?font_size=40&font_text=Abcd&font_color=000000000&font_id={{ text_item.id }}&font_thumbnail=0</option>
                                                {% endfor %}
                                            </select>
                                            <textarea id="text-change" name="text-change"></textarea>
                                            <a href="#" id="text-update">update</a>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div id="object-counter" style="display:none;"></div>
                        </div> <!-- end of canvas-->
                    </td>
                </tr>
            </tbody>
        </table>
        <div id="compact-footer">
            <table border="0" cellpadding="0" cellspacing="0">
                <tfoot class="footWrap">
                    <tr>
                        <td class="clearfix">
                            <div class="copyright">{{ "footer"|get_interface_info }}</div>
                            <div class="footerMenus">
                                <ul>{{ "footer_menu"|get_interface_info }}</ul>
                            </div>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>
        <div id="remove_products_container" style="display:none"></div>
        <div id="idecorate-tooltip" class="idecorateTooltip" style="display:none">
            <div class="container-tooltip">
                <table cellspacing="0" cellpadding="0">
                    <tbody>
                        <tr valign="top">
                            <td width="42%">
                                <img id="tooltip-image" alt="" src="">
                            </td>
                            <td>
                                <div style="overflow: hidden; padding-left: 8px;">
                                    <ul class="list">
                                        <li id="tooltip-title"></li>
                                        <li id="tooltip-price"></li>
                                        <li id="tooltip-unit"></li>
                                    </ul>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="close">Ã—</div>
        </div>

        <div id="page-mask" style="display:none;"></div>
        <div id="modal-window" style="display:none;">
            <h2 id="modal-header">
                <a href="#" id="close-modal">&times;</a>
            </h2>
            <div id="iframe-wrap"></div>
        </div>

        <!-- login. signup modal -->
        <div id="modal-login-signup-window" style="display:none;">
            <h2 id="modal-login-signup-header">
                <a href="#" id="close-login-signup-modal" class="close-modal-btn">&times;</a>
            </h2>
            <div id="iframe-login-signup-wrap"></div>
        </div>

        <div id="modal-save-styleboard-window" style="display:none;">
            <h2 id="modal-save-styleboard-header">
                <a href="#" id="close-save-styleboard-modal" class="close-modal-btn">&times;</a>
            </h2>
            <div id="iframe-save-styleboard-wrap"></div>
        </div>
<script type="text/javascript" src="/media/interface/js/jquery-1.8.2.min.js"></script>
<script type="text/javascript" src="/media/interface/js/jquery.placeholder.js"></script>
<script type="text/javascript" src="/media/interface/js/colorpicker/js/spectrum.js"></script>
<script type="text/javascript" src="/media/interface/js/selectbox/js/jquery.selectbox-0.2.js"></script>
<script type="text/javascript" src="/media/interface/js/jquery-ui.js"></script>
<script src="/media/interface/js/jquery.form.js"></script>
<script src="/media/interface/js/jquery.progressbar.js"></script>
<!--[if lt IE 9]>
    <script type="text/javascript" src="/media/interface/js/ui/ie-jquery.ui.rotatable.js"></script>
<![endif]-->
<![if !IE]>
    <script type="text/javascript" src="/media/interface/js/ui/jquery.ui.rotatable.js"></script>
<![endif]>
<!--[if IE 9]>
    <script type="text/javascript" src="/media/interface/js/ui/jquery.ui.rotatable.js"></script>
<![endif]-->
<!-- PYTHON CRF -->
<script type="text/javascript" src="/media/admin/js/csrf.js"></script>
<!-- CART -->
<script type="text/javascript" src="/media/interface/js/cart.js"></script>
<!-- MENU BAR -->
<script type="text/javascript" src="/media/interface/js/dropdown/js/jquery.dropdown.js"></script>
<script type="text/javascript" src="/media/interface/js/dropdown/js/jquery.hoverflow.js"></script>
<!-- STYLEBOARD TABPANNELS -->
<script type="text/javascript" src="/media/interface/js/tabpannel/jquery.hashchange.min.js"></script>
<script type="text/javascript" src="/media/interface/js/tabpannel/jquery.easytabs.min.js"></script>
<script type="text/javascript" src="/media/interface/js/tabpannel/jquery.change.tab.js"></script>
<!-- PRODUCT CATEGORIES AJAX CALLS -->
<script type="text/javascript" src="/media/interface/js/jquery.mousewheel.js"></script>
<script type="text/javascript" src="/media/js/jquery.cookie.js"></script>
<script type="text/javascript" src="/media/interface/js/product_category.js"></script>
<!--Embellishments -->
<script type="text/javascript" src="/media/interface/js/embellishments.js"></script>
<!--Personalize -->
<script type="text/javascript" src="/media/interface/js/personalize.js"></script>
<!--templates -->
<script type="text/javascript" src="/media/interface/js/templates.js"></script>
<!-- IDECORATE APP -->
<script type="text/javascript" src="/media/interface/js/jquery.app.js"></script>
<script type="text/javascript" src="https://raw.github.com/furf/jquery-ui-touch-punch/master/jquery.ui.touch-punch.min.js"></script>
<script type="text/javascript">

    $(document).ready( function() {

        $(':input[placeholder]').placeholder();
        
        $('.dd').dropdown({
            subClass: 'sub-menu'
        }).show();

        styleboardH();

        $(window).hashchange(function(){
            if (location.hash != '' && location.hash == '#create-tab'){
                styleboardH();                               
                if ( !has_change_mode ){
                    {% if mode != 'search' %}
                        {% if category_count == 0 %}
                        setTimeout(populate_products,1000);
                        {% endif %}
                    {% else %}
                        setTimeout("search_products('{{ keyword }}','{{ keyword_cat }}')",500);
                    {% endif %}
                } else {
                    if($.browser.msie && ($.browser.version == 7.0 || $.browser.version == 8.0)){
                        if ($.browser.version == 8.0)
                            mode_toggle_tab = true;
                        setTimeout(manage_product_pagination,0);
                    }
                }
            } else if (location.hash == '#buy-tab') {
                setTimeout(styleboardH,50);
                $('.category-wrap .thumb.categories').addClass('hidden');
            }  else {
                styleboardH();
                if ( !has_change_mode ){
                    {% if mode != 'search' %}
                        {% if category_count == 0 %}
                        setTimeout(populate_products,500);
                        {% endif %}
                    {% else %}        
                        setTimeout("search_products('{{ keyword }}','{{ keyword_cat }}')",500);
                    {% endif %}
                } else {
                    if($.browser.msie && ($.browser.version == 7.0 || $.browser.version == 8.0)){
                        if ($.browser.version == 8.0)
                            mode_toggle_tab = true;
                        setTimeout(manage_product_pagination,0);
                    }
                }
            }
        });
        $(window).hashchange();
        
        $('#create-tab-nav').changeTab();
        
        $('#sidebar-wrap').easytabs({ animate:false }).bind('easytabs:after',function(){
            recur = false;
            setTimeout(set_category_label_height,500);
        });
    });


    var SEARCH_SUGGESTION_URL = '{% url search_suggestions %}';

</script>
<script src="/media/interface/js/search.js"></script>
<script type="text/javascript">

    $(window).resize(styleboardH);

    function styleboardH() {


        var _height     = $(window).height()-
                        $("#compact-header").outerHeight(true)-
                        $("#compact-footer").outerHeight(true)-11;

        var __height    = _height-
                        $("#sidebar-nav").outerHeight(true)-
                        $("#sidebar-form-wrap").outerHeight(true)-
                        $("#create-tab-nav").outerHeight(true)-
                        $("#create-tab .breadcrumb").outerHeight(true);

        var ___height   = __height-
                        $("#create-tab .pagination").outerHeight(true)-1;

        var ____height  = $('.thumb.products').outerHeight(true)+10;
        var ____height_ = $('.thumb.temp').outerHeight(true)+10;

        var _____height = _height-
                        $("#sidebar-nav").outerHeight(true)-
                        $("#sidebar-form-wrap").outerHeight(true);

        var ______height= _height-
                        $("#sidebar-nav").outerHeight(true)-
                        $("#sidebar-form-wrap").outerHeight(true)-
                        $('#buy-tab .buyTableWrap .thead').outerHeight(true)-
                        $('#buy-tab .buyTableWrap .tfoot').outerHeight(true)-
                        $('#buy-tab .checkOutWrap').outerHeight(true);

        var height_     = $('#buy-tab .buyTableWrap .thead').outerHeight(true)+
                        $('#buy-tab .buyTableWrap .tfoot').outerHeight(true)+
                        $('#buy-tab .checkOutWrap').outerHeight(true);

        
        $('#styleboard').height(_height); 
        $('#canvas').height(_height-1); 
        $('#create-tab .category-wrap').height(__height);
        $('#embellishments').height(__height+$("#create-tab .breadcrumb").outerHeight(true));
        $('#create-tab .product-list-wrap .product-list').height(___height).css({minHeight:____height});
        $('#buy-tab').height(_____height).css({minHeight:height_});
        $('#buy-tab .buyTableWrap .table .tbody').height(______height);        
        $('#embelishments-list-wrap').height(______height-$('#embellishments .formWrap').outerHeight(true)+17);

        var height__ = _height-
                        $("#sidebar-nav").outerHeight(true)-
                        $("#sidebar-form-wrap").outerHeight(true)-
                        $("#create-tab-nav").outerHeight(true)-
                        $("#template .template-wrap").outerHeight(true)-
                        $("#template .pagination").outerHeight(true);
                        
        $('#templates').height(height__).css({minHeight:____height_});

    }

    $(function(e){
        styleboardH();

        $('.close-modal-btn').click(function(e){
            e.preventDefault();
            $('#page-mask').hide();
            $(this).parent().parent().hide();
        });
        generate_user_nav();
        $('#save').click(function(e){
            e.preventDefault();

            //if ($('#canvas-wrap .product').length>0 || $('.notEmpty').length > 0 || $('.embellishment.unselected').length > 0)
            if(objCounter > 0) {    

                pop_save_styleboard();
            }
        });
    });
    function generate_user_nav(){
        var navs = '<li><a href="#" id="logged_as">{{ user|get_nickname }}</a></li>' + 
        '<li><a id="lnk-logout" href="#">Logout</a></li>' + 
        '<li><a href="#" id="lnk-login-signup">Login/Signup</a></li>';        
        $('#site-menu ul.dd').append(navs);
        $('#lnk-logout').bind('click',function(e){
            e.preventDefault();
            logmeout();
        });
        $('#logged_as').bind('click',function(e){
            e.preventDefault();
            goto_profile();
        });
        $('#site-menu ul a#lnk-login-signup').bind('click',function(e){
            e.preventDefault();
            popup_login();
        });
        {% if user.is_authenticated %}        
        $('#lnk-login-signup').parent().hide();
        {% else %}
        $('#logged_as').parent().hide();
        $('#lnk-logout').parent().hide();
        {% endif %}
    }
    function goto_profile(){
        window.location.href = '{% url profile %}';
    }
    function logged(val){
        logined = true;
        $('#logged_as').text(val);
        $('#lnk-login-signup').parent().hide();
        $('#logged_as').parent().show();
        $('#lnk-logout').parent().show();
        closed_modal();
        if (save_styleboard_action){
            save_styleboard_action = false;
            save_styleboard_modal();
        }
        //document.location.reload(true);
    }
    function logmeout(){
        $.get('{% url logout %}', function(e){
            document.location.reload(true);
        });
        $('#lnk-login-signup').parent().show();
        $('#logged_as').parent().hide();
        $('#lnk-logout').parent().hide();
        logined = false;
        return false;
    }
    function closed_modal(){
        $('#page-mask').hide();
        $('#modal-login-signup-window').hide();
    }
    function popup_login(){
        var iframe  = $('<iframe />').attr({'class':'modalIframe','id':'modal-login-signup-iframe','src':"{% url login_signup %}",'frameborder':'0'});
        var modal   = $('#modal-login-signup-window'),
            _left   = $(window).width()/2-modal.width()/2;
            frame   = $('#iframe-login-signup-wrap').html(iframe);

        $('#page-mask').css({display:'block'});
        modal.css({display:'block',left:_left});
    }
    function pop_save_styleboard(){
        save_styleboard_action = true;
        if (logined)
            save_styleboard_modal();
        else
            popup_login();
    }
    function save_styleboard_modal(){
        var url = '{% url save_styleboard %}';
        {% if sbid %}
        url = url + '?sbid={{ sbid }}';
        {% endif %}
        var iframe  = $('<iframe />').attr({'class':'modalIframe','id':'modal-save-styleboard-iframe','src':url,'frameborder':'0'});
        var modal   = $('#modal-save-styleboard-window'),
            _left   = $(window).width()/2-modal.width()/2;
            frame   = $('#iframe-save-styleboard-wrap').html(iframe);

        $('#page-mask').css({display:'block'});
        modal.css({display:'block',left:_left});
    }
    function save_styleboard_success(msg){
        $('#page-mask').hide();
        $('#modal-save-styleboard-window').hide();
        alert(msg);
    }

    function dragInit(){
        //draggable event
        $(".draggable").draggable({
            revert:true, 
            helper: 'clone',
            containment: 'body'
        });
    }
</script>

<script type="text/javascript" src="/media/firebug/tests/firebug-lite-debug.js"></script>
    
    </body>
</html>
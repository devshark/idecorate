{% extends "base.html" %}
{% load i18n plata_tags idecorate_interface humanize widget_tweaks %}
{% block title %}iDecorate Weddings{% endblock %}
{%  block style %}
<link rel="stylesheet" type="text/css" href="/media/interface/css/shop_checkout.css">
<link runat="server" rel="shortcut icon" href="/media/images/favicon.1.ico" type="image/x-icon" />
<link runat="server" rel="icon" href="/media/images/favicon.1.ico" type="image/ico" />
<style>
	@-moz-document url-prefix() {
		.calendarWrapper img {
			right: 20%;
		}
	}
</style>
<!--[if lte IE 9]>
	<style type="text/css">
		.calendarWrapper input {
			width: 170px;
		}
		.calendarWrapper img {
			right: 9%;
		}
		.delivery select, .paymentMethod select {
			width: 360px !important;
		}
	</style>
<![endif]-->
{% endblock %}
{% block content %}
<div class="clearfix checkout">
	<h3>Checkout</h3>
	<div class="clearfix orderWrap">
		
		{% if orderform.errors %}
		<div class="clearfix errorBlock">
			<a href="" class="closeX">x</a>
			<h4>Please correct the following errors:</h4>
			<ol>
	          {% for e in orderform.billing_first_name.errors %}
	            <li>{{ e }}</li>
	          {% endfor %}
	          {% for e in orderform.billing_last_name.errors %}
	            <li>{{ e }}</li>
	          {% endfor %}
	          {% for e in orderform.email.errors %}
	            <li>{{ e }}</li>
	          {% endfor %}
	          {% for e in orderform.shipping_address.errors %}
	            <li>{{ e }}</li>
	          {% endfor %}
	          {% for e in orderform.shipping_zip_code.errors %}
	            <li>{{ e }}</li>
	          {% endfor %}
	          {% for e in orderform.billing_address.errors %}
	            <li>{{ e }}</li>
	          {% endfor %}
	          {% for e in orderform.billing_zip_code.errors %}
	            <li>{{ e }}</li>
	          {% endfor %}
	          {% for e in orderform.shipping_date.errors %}
	            <li>{{ e }}</li>
	          {% endfor %}
	          {% for e in orderform.payment_method.errors %}
	            <li>{{ e }}</li>
	          {% endfor %}
			</ol>
		</div>
		{% endif %}
		<div class="clearfix orderTable">MY ORDER</div>
		<fieldset>
			<!-- <legend>Your Order</legend> -->
			<table>
				<thead>
					<tr>
						<th>Items</th>
						<th>Unit Cost</th>
						<th>Quantity</th>
						<th>Total Cost</th>
					</th>
				</thead>
				<tbody>
					{{ order.items|generate_product_order_list:order }}
				</tbody>
				<tfoot>
					<tr>
						<td></td>
						<td></td>
						<td>
							<p>{{ guest_table.guests }} Guests</p>
							<p>{{ guest_table.tables }} Tables</p>
						</td>
						<td>
							<p><!-- + $100 Shipping Fee -->&nbsp;</p>
							<p>Total: ${{ order.total|floatformat:2|intcomma }}</p>
							<button type="button" id="edit_button">Edit</button>
						</td>
					</tr>
				</tfoot>
			</table>
		</fieldset>
	</div>
	<form method="post" action=".">
		{% csrf_token %}
		<input type="hidden" name="_checkout" value="1" />
		<div class="clearfix loginDetails">
			<h4>Are you a returning customer?</h4>
			<p align="justify">If you have previously placed an order with us, no need to fill in your address and personal details again. Just login and choose your preferred payment method and you're done!</p>
			<p align="justify">If you're a new customer, we'll automatically create an account for you after you have finished your order.</p>
				<input type="text" placeholder="Email" />
				<input type="password" placeholder="Password" />
				<input type="submit" value="Login" class="submit" />
				<a href="#">Forgot your password?</a>
		</div>
		<div class="clearfix information">
			<fieldset class="personal">
				<legend>Personal Information</legend>
				<br />
					<div class="clearfix">
						<label>Salutations</label>
						{{ orderform.billing_salutation }}
					</div>
					<div class="clearfix">
						<label>First Name</label>
						{{ orderform.billing_first_name }}
					</div>
					<div class="clearfix">
						<label>Last Name</label>
						{{ orderform.billing_last_name }}
					</div>
					<div class="clearfix">
						<label>Email</label>
						{{ orderform.email }}
					</div>
			</fieldset>
			<fieldset class="delivery">
				<legend>Delivery Address</legend>
				<br />
					<div class="clearfix">
						<label>Address 1</label>
						{{ orderform.shipping_address }}
					</div>
					<div class="clearfix">
						<label>Address 2</label>
						{{ orderform.shipping_address2 }}
					</div>
					<div class="clearfix">
						<label>State</label>
						{{ orderform.shipping_state|add_class:"districtList" }}
					</div>
					<div class="clearfix">
						<label>City</label>
						{{ orderform.shipping_city|add_class:"districtList" }}
					</div>
					<div class="clearfix">
						<label>Postal Code</label>
						{{ orderform.shipping_zip_code }}
					</div>
					{{ orderform.shipping_same_as_billing|attr:"class:checkbox" }} My delivery address is the same as my billing address.
			</fieldset>
		</div>

	<div class="clearfix" style="width: 100%; height: auto;">
		<div class="leftPannel">
			<fieldset class="deliveryDate">
	            <legend>Delivery Date</legend>
				<br />
					<div class="clearfix calendarWrapper">
	                	{{ orderform.shipping_date|attr:"placeholder:Date"|attr:"id:datepicker"|attr:"readonly:readonly" }}
	                </div>
	             	{{ "delivery_date_note"|get_checkout_page_info }}
	        </fieldset>
	        <fieldset class="question">
	            <legend>Any Questions?</legend>
				<br />
	            <p align="justify">{{ "any_question"|get_checkout_page_info }}</p>
	        </fieldset>
		</div>
		<div class="rightPannel">
            <fieldset class="delivery paymentMethod" id="billing_orig">
                <legend>Billing Address</legend>
				<br />
                    <div class="clearfix">
                        <label>Address 1</label>
                        {{ orderform.billing_address }}
                    </div>
                    <div class="clearfix">
                        <label>Address 2</label>
                        {{ orderform.billing_address2 }}
                    </div>
                    <div class="clearfix">
                        <label>State</label>
                        {{ orderform.billing_state|add_class:"districtList" }}
                    </div>
                    <div class="clearfix">
                        <label>City</label>
                        {{ orderform.billing_city|add_class:"districtList" }}
                    </div>
                    <div class="clearfix">
                        <label>Postal Code</label>
                        {{ orderform.billing_zip_code }}
                    </div>
            </fieldset>
	        <fieldset class="paymentMethod2" id="payment_orig">
	            <legend>Payment Method</legend>
				<br />

	                {% for choice in orderform.payment_method.field.choices %}
	                <div class="clearfix">
	                    <input type="radio" name="order-payment_method" value="{{ choice.0 }}" {% if orderform.payment_method.data == choice.0 %}checked="checked" {% endif %}/>
	                    <label>{{choice.1}}</label>
	                    {{ choice.0|getImagePaymentMethod }}
	                </div>
	                {% endfor %}

	        </fieldset>
		</div>
	</div>
	<div class="clearfix disclaimer" style="clear: both;">
		<p align="justify">{{ "t_and_c"|get_checkout_page_info }}</p>
		<button type="submit">Proceed to Payment</button>
	</div>
	</form>
</div>
{% endblock %}
{% block javascripts %}
<script type="text/javascript">
QUESTION_ORIGINAL_SIZE = 0;

	$(function(){

		//page_H();

		QUESTION_ORIGINAL_SIZE = $('.question').height();

		$('#edit_button').click(function(e){
			var url = '{% url styleboard %}';
			{% if request.session.personalize_id %}
				url = url+'?sbid={{ request.session.personalize_id }}';
			{% endif %}
			url = url + '#buy-tab';
			window.location = url;
			
		});

		$('#id_order-shipping_same_as_billing').click(function(e){

			hideBilling()

		});
		resizeUpperInfos();
		resizeInfos();
		hideBilling()
		
	});

	//$(window).resize(page_H);
/*
	function page_H(){
			
		var windowH = $(window).height();
			headerH = $('#header').outerHeight(true);
			footerH = $('#footer').outerHeight(true);
			newHeight = windowH - headerH - footerH + 190;

		if($(document).height()<$(window).height()) {
			$('.checkout').height(newHeight);
		} else if(newHeight<windowH){
			$('.checkout').height(newHeight);
		}
	}
*/
	function resizeUpperInfos() {
		var deliveryH = $('.delivery').height(),
			personalH = $('.personal').height();

		if(personalH < deliveryH) {
			$('.delivery').height(deliveryH);
			$('.personal').height(deliveryH);
		} else {
			$('.delivery').height(personalH);
			$('.personal').height(personalH);
		}
	}
		
	function resizeInfos() {

		var deliveryDateH = $('.deliveryDate').height(),
			paymentMethodH = $('.paymentMethod').height(),
			paymentMethodH2 = $('.paymentMethod2').height(),
			questionH = $('.question').height();


		if($('input[name="order-shipping_same_as_billing"]:checked').val() == 'on') {
			if(deliveryDateH > paymentMethodH2){
				$('.deliveryDate').height(deliveryDateH);
				$('.paymentMethod2').height(deliveryDateH);
			}else{
				$('.deliveryDate').height(paymentMethodH2);
				$('.paymentMethod2').height(paymentMethodH2);
			}

			$('.question').height(QUESTION_ORIGINAL_SIZE);
		} else {

			if(deliveryDateH > paymentMethodH){
				$('.deliveryDate').height(deliveryDateH);
				$('.paymentMethod').height(deliveryDateH);
			}else{
				$('.deliveryDate').height(paymentMethodH);
				$('.paymentMethod').height(paymentMethodH);
			}

			if(questionH > paymentMethodH2){
				$('.question').height(questionH);
				$('.paymentMethod2').height(questionH);
			}else{
				$('.paymentMethod2').height(paymentMethodH2);
				$('.question').height(paymentMethodH2);
			}
		}
	}

	function hideBilling() {
		if($('input[name="order-shipping_same_as_billing"]:checked').val() == 'on') {
			$('#billing_orig').hide();
		} else {
			$('#billing_orig').show();
		}

		resizeInfos();
	}

</script>
<script src="/media/interface/js/jquery.placeholder.js"></script>
<script type="text/javascript">
$(':input[placeholder]').placeholder();
</script>
{% endblock %}